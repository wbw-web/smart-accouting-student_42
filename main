#!/usr/bin/env python3
"""
æ™ºèƒ½è®°è´¦åº”ç”¨ä¸»ç¨‹åº
"""

import json
import os
from datetime import datetime

class AccountingApp:
    def __init__(self):
        self.data_file = "accounting_data.json"
        self.records = self.load_data()
        
        # æ¶ˆè´¹åˆ†ç±»å­—å…¸
        self.categories = {
            'food': ['é¤é¥®', 'å¤–å–', 'é›¶é£Ÿ', 'è¶…å¸‚', 'æ°´æœ'],
            'transport': ['å…¬äº¤', 'åœ°é“', 'æ‰“è½¦', 'ç«è½¦', 'æœºç¥¨'],
            'entertainment': ['ç”µå½±', 'æ¸¸æˆ', 'æ—…æ¸¸', 'KTV', 'è´­ç‰©'],
            'education': ['ä¹¦ç±', 'è¯¾ç¨‹', 'åŸ¹è®­'],
            'other': ['å…¶ä»–']
        }
    
    def load_data(self):
        """åŠ è½½æ•°æ®"""
        if os.path.exists(self.data_file):
            with open(self.data_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return []
    
    def save_data(self):
        """ä¿å­˜æ•°æ®"""
        with open(self.data_file, 'w', encoding='utf-8') as f:
            json.dump(self.records, f, ensure_ascii=False, indent=2)
    
    def add_record(self, amount, description, category=None):
        """æ·»åŠ è®°è´¦è®°å½•"""
        if category is None:
            category = self.auto_categorize(description)
        
        record = {
            'id': len(self.records) + 1,
            'amount': float(amount),
            'description': description,
            'category': category,
            'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        }
        
        self.records.append(record)
        self.save_data()
        print(f"âœ… è®°å½•æ·»åŠ æˆåŠŸ: {record}")
        return record
    
    def auto_categorize(self, description):
        """è‡ªåŠ¨åˆ†ç±»"""
        for category, keywords in self.categories.items():
            if any(keyword in description for keyword in keywords):
                return category
        return 'other'
    
    def show_summary(self):
        """æ˜¾ç¤ºæ±‡æ€»"""
        if not self.records:
            print("æš‚æ— è®°è´¦è®°å½•")
            return
        
        total = sum(record['amount'] for record in self.records)
        print(f"\nğŸ“Š è®°è´¦æ±‡æ€»")
        print(f"æ€»è®°å½•æ•°: {len(self.records)}")
        print(f"æ€»é‡‘é¢: {total:.2f}å…ƒ")
        
        # æŒ‰ç±»åˆ«æ±‡æ€»
        category_sum = {}
        for record in self.records:
            cat = record['category']
            category_sum[cat] = category_sum.get(cat, 0) + record['amount']
        
        print("\nğŸ“ˆ åˆ†ç±»ç»Ÿè®¡:")
        for cat, amount in category_sum.items():
            print(f"  {cat}: {amount:.2f}å…ƒ")

def main():
    app = AccountingApp()
    
    while True:
        print("\nğŸ’ æ™ºèƒ½è®°è´¦åº”ç”¨")
        print("1. æ·»åŠ è®°å½•")
        print("2. æŸ¥çœ‹æ±‡æ€»") 
        print("3. é€€å‡º")
        
        choice = input("è¯·é€‰æ‹©æ“ä½œ (1-3): ").strip()
        
        if choice == '1':
            try:
                amount = input("è¾“å…¥é‡‘é¢: ")
                description = input("è¾“å…¥æè¿°: ")
                app.add_record(amount, description)
            except ValueError:
                print("âŒ é‡‘é¢æ ¼å¼é”™è¯¯!")
        
        elif choice == '2':
            app.show_summary()
        
        elif choice == '3':
            print("å†è§! ğŸ‘‹")
            break
        
        else:
            print("âŒ æ— æ•ˆé€‰æ‹©")

if __name__ == "__main__":
    main()
